<head th:replace="common/header.html::header"></head>
<div th:replace="common/drawer.html::drawer"></div>
<v-main id="app">
    <v-container fluid> 
        <v-data-table :headers="dataTablePedido.headers" :items="dataTablePedido.items"
     class="elevation-1" :footer-props="dataTablePedido.footerProps" :server-items-length="dataTablePedido.totalItens" :items-per-page="dataTablePedido.itemsPerPage"
    no-data-text="Não ha dados" :page.sync="dataTablePedido.dataTablePage"
     >

            <template v-slot:top>
                <v-toolbar flat>
                    <v-toolbar-title>Pedidos de Viatura Abertos</v-toolbar-title>
                    <v-divider class="mx-4" inset vertical></v-divider>
                    <v-spacer></v-spacer>
                    <v-text-field dense hide-details v-model="search" label="Pesquisa"></v-text-field>
                    <v-spacer></v-spacer>

                    
                </v-toolbar>
            </template>
            <template v-slot:item.saidadate="{ item }">
                <span>{{ formatarData(item.saidaDate) }} -- </span>
              </template>
            <template v-slot:item.saidaDate="{ item }">
                <span v-html="formatDate(item.saidaDate)"></span>
              </template>
       
            <template v-slot:item.actions="{ item }">
                <v-icon v-if="item.status !== 'Aprovado'" 
                    small class="ms-3" title="Editar" @click="editarPedido(item)">
                    mdi-pencil
                </v-icon>
                <v-icon  v-if="item.status !== 'Aprovado'" small class="ms-3" title="Exlcuir" @click="excluirPedido(item)">
                    mdi-delete
                </v-icon>
            </template>
            <!-- Atributos aglutinados -->
             <template v-slot:item.n ="{ item }">
                  {{ item.viaturas ? (item.viaturas.modeloViatura + ' ' + item.viaturas.placaViatura) : ' ' }}
             </template>
             <template v-slot:item.motorista="{ item }">
                {{ item.motoristas ? (item.motoristas.graduacaoMotorista + ' ' + item.motoristas.nomeGuerraMotorista) : ' ' }}
             </template>
             <template v-slot:item.modelviatura="{ item }">
                {{ getViaturaInfo(item) }}
            </template>
             <template v-slot:item.responsavel="{item}">
                {{ item.postGraduacao + ' '+ item.nomeGuerra}}
             </template>
             <template v-slot:item.saidadate="{ item }">
                <span>{{ formatarData(item.saidaDate) }}  </span>
              </template>
        </v-data-table>
        <v-dialog width="900" v-model="novoPedidoDialog">
            <v-card>
                    <v-card-title>
                        Pedido Viatura 
                    </v-card-title>
                <v-form ref="form" lazy-validation>
                    <v-card-text>
                        <v-row>
                            <v-col cols="2">
                                <v-select dense outlined v-model="novoPedido.postGraduacao" label="Posto Graduação"
                                    :items="['CMG', 'CF', 'CC', 'CT', '2° TEN', '1° TEN', 'GM', 'SO', '1°SG', '2°SG', '3°SG', 'CB', 'MN']" required
                                    :rules="obrigatorio" disabled ></v-select>
                            </v-col> 
                            <v-col cols="3">
                                <v-text-field dense outlined v-model="novoPedido.nomeGuerra" name="nomeGuerra" label="Nome de Guerra" required
                                    :rules="obrigatorio" class="upper" disabled></v-text-field>
                            </v-col>
                            <v-col cols="3">
                                <v-text-field dense outlined v-model="novoPedido.telefone" name="telefone" label="Telefone/Ramal" required
                                    v-mask="'#####'" :rules="obrigatorio" disabled ></v-text-field>   
                            </v-col>
                            <v-col cols="4">
                                <v-select dense outlined v-model="novoPedido.status" name="status" label="Status"
                                    :items="['Em análise', 'Aprovado', 'Rejeitado', 'Cancelado']" required
                                    :rules="obrigatorio" ></v-select>
                            </v-col> 
                            <v-col cols="3">
                                <v-text-field dense outlined v-model="novoPedido.localPartida" name="localPartida" label="Local de Ṕartida" required
                                :rules="obrigatorio" class="upper" :disabled="modoVisualizacao"></v-text-field>
                            </v-col>
                            <v-col cols="3">
                                <v-text-field dense outlined v-model="novoPedido.destino" name="destino" label="Destino" required
                                class="upper" disabled ></v-text-field>
                            </v-col>
                            <v-col cols="3">
                                <v-text-field dense outlined v-model="novoPedido.materialTransportar" name="materialTransportar" label="Transporte de Material" required
                                disabled ></v-text-field>
                            </v-col>
                            <v-col cols="3">
                                <v-text-field dense outlined v-model="novoPedido.passageirosQnt" name="passageirosQnt" label="Numero de Passageiros" :rules="obrigatorio" required
                                    v-mask="'#####'" disabled></v-text-field>
                            </v-col> 
                            <v-col cols="6">
                                <v-text-field dense outlined v-model="novoPedido.saidaDate" name="saidaDate" label="Data de Viagem" required type="date"></v-text-field>
                            </v-col>
                            <v-col cols="6">
                                <v-text-field dense outlined v-model="novoPedido.saidaHora" name="saidaHora" label="Hora" required type="time" ></v-text-field>
                            </v-col>
                            <v-col cols="6">
                                <v-select dense outlined v-model="novoPedido.om" 
                                    name="om" label="OM"
                                    :items="clienteBnic"
                                    item-text="cdAbrvOm"
                                    item-value="cdAbrvOm"
                                    :rules="obrigatorio"  
                                    :disabled="modoVisualizacao"
                                    required
                                   >
                                </v-select>
                            </v-col>
                            <v-col cols="6">
                                <v-select dense outlined v-model="novoPedido.centralizado"  name="centralizado" label="Centralizado" 
                                    :items="['Centralizado', 'Não centralizado']" required
                                    :rules="obrigatorio"  :disabled="modoVisualizacao"></v-select>
                            </v-col> 

                            <v-col cols="3">
                                <v-select dense outlined v-model="novoPedido.motorista" 
                                    name="Motorista" label="Nome Motorista"
                                    :items="listMotoristas"
                                    item-text="nomeGuerraMotorista"
                                    item-value="id"
                                    required
                                   >
                                   <template v-slot:selection="{ item }">
                                    {{ item.graduacaoMotorista }} - {{ item.nomeGuerraMotorista }}
                                </template>
                                <template v-slot:item="{ item }">
                                    {{ item.graduacaoMotorista }} - {{ item.nomeGuerraMotorista }}
                                </template>
                                </v-select>
                            </v-col>
                            <v-col cols="5">
                                <v-select dense outlined v-model="novoPedido.viatura" @input="atualizarModeloViatura"
                                    name="Viatura" label="Viatura"
                                    :items="listViaturas"
                                    item-text="modelviatura"
                                    item-value="id"
                                    required>
                                    <template v-slot:selection="{ item }">
                                        {{ item.modeloViatura }} / {{ item.placaViatura }}
                                    </template>
                                    <template v-slot:item="{ item }">
                                        {{ item.modeloViatura }} / {{ item.placaViatura }}
                                    </template>
                                </v-select>
                            </v-col> 
                            <v-col cols="4">
                                <v-select dense outlined v-model="novoPedido.centralizado"  name="centralizado" label="Centralizado" 
                                    :items="['SIM', 'NÃO']" required
                                    :rules="obrigatorio"  ></v-select>
                            </v-col>      
                            <v-col cols="6">
                                <v-textarea dense outlined v-model="novoPedido.observacoes" name="observacoes" label="Descrição" rows="2" row-height="25" shaped disabled>
                                </v-textarea> 
                            </v-col>
                            <v-col cols="6">
                                <v-textarea dense outlined v-model="novoPedido.orientacoes" name="orientacoes" label="Orientacoes" rows="2" row-height="25" shaped>
                                </v-textarea>
                            </v-col>     
                        </v-row>
                    </v-card-text>
                    <v-card-actions>
                        <v-btn color="primary" @click="novoPedidoDialog = false">Fechar</v-btn>
                        <v-btn v-if="!modoVisualizacao" type="submit" color="primary" @click.prevent="salvar">Salvar</v-btn>
                    </v-card-actions>
                </v-form>
            </v-card>

        </v-dialog>
    </v-container>
</v-main>
</v-app>
<div th:replace="common/footer.html::footer"></div>
<script src="js/custom/pedidoAberto.js"></script>
</body>

</html>
